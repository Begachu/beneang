# Docker와 Kubernetes 이해
## 컨테이너 정의
- 격리된 공간에서 프로세스가 동작하는 기술
## 도커의 정의
- 컨테이너 기반의 오픈소스 가상화 플랫폼
## Hypervisor 기반 가상화
- 기존의 가상화 방식은 주로 OS를 가상화하였다.
- VMware나 VirtualBox 같은 가상머신은 호스트 OS 위에 게스트 OS 전체를 가상화하여 사용하는 방식이다.
- 이와 같이 추가적인 OS를 설치하여 가상화하는 방법은 overhead가 발생하였고, 이를 개선하기 위해 프로세스 격리하는 방식이 등장했다.
## Container 기반 가상화
- 단순 프로세스를 격리시키기 때문에 가볍고 빠르게 동작한다.
- CPU, Memory는 프로세스가 필요한만큼만 사용하므로 성능상의 이슈는 거의 없다.
- 컨테이너를 사용하다 보면 가벼운 VM의 느낌을 준다.
## Docker는 Client와 Server (Docker Host) 구조
- Client : user가 'docker run' 등의 명령어를 입력하면 이를 Server쪽에 전송하고, 이를 Docker daemon이 수행한다.
- Docker daemon : docker api 요청을 수신하고 image, container, network, volume과 같은 docker object를 관리한다. 다른 docker daemon과의 통신을 통해 서비스를 관리할 수 있다.
- Docker Registry : Docker 이미지 저장소이다.
- Image : 컨테이너 실행에 필요한 파일과 설정값 등을 포함하고 있다. (Immutable) 공식 이미지의 경우 해당 이미지를 실행하기 위한 모든 것이 세팅되어 있다.
## 도커의 특징
- 레이어 저장방식
    - 도커 이미지는 컨테이너를 실행하기 위한 모든 정보를 가지고 있기 때문에 용량이 크다. 처음 이미지를 다운받을 때는 크게 부담이 되지 않지만, 기존 이미지에 파일 하나 추가했다고 다시 해당 용량이 큰 파일을 다시 받는건 비효율적이다.
    - 도커는 이런 문제를 해결하기 위해서 Layer라는 개념을 사용하고 유니온 파일 시스템을 이용하여 여러개의 레이어를 하나의 파일시스템으로 사용할 수 있게 해준다
    - 컨테이너 생성할 때도 레이어 방식을 사용하여 기존의 이미지 레이어 위에 읽기/쓰기(read-write) 레이어를 추가한다.
- Dockerfile
    - 도커는 이미지를 만들기 위해 Dockerfile이라는 파일에 자체 DSL(Domain-specific language) 언어를 이용하여 이미지 생성 과정을 적는다.
    - Application 실행에 필요한 과정들을 Dockerfile로 작성하여 관리할 수 있으며, 해당 Dockerfile을 보면서 이미지 생성과정을 알 수 있으므로 수정하기도 용이하다.
- Docker Hub
    - Docker hub를 통해 공개 이미지를 무료로 관리해줍니다. 공식 이미지를 직접 관리해주며, namespace가 없다.
## 쿠버네티스 정의
- 쿠버네티스는 컨테이너 오케스트레이션 툴
## 오케스트레이션이란?
- 컨테이너 역시 그 수가 많아지게 되면, 관리와 운영에 있어서 어려움이 따른다.
- 컨테이너 오케스트레이션은, 이러한 다수의 컨테이너 실행을 관리 및 조율하는 시스템
- 오케스트레이션 엔진을 통해, 컨테이너의 생성과 소멸, 시작 및 중단 시점 제어, 스케줄링, 로드 밸런싱, 클러스터링 등
- 컨테이너로 어플리케이션을 구성하는 모든 과정을 관리할 수 있다.
- 다른 컨테이너 오케스트레이션 툴로는 '도커 스웜', 'ECS', 'Nomad'등이 있다.
## 쿠버네티스 특징
- 자동화된 복구(self-healing)
    - 컨테이너들을 모니터링하며, 컨테이너 중 하나라도 죽으면 쿠버네티스는 그것을 빠르게 재시작 시킨다.
- 로드 밸런싱(Load balancing)
    - 만약 1만명의 유저가 접속하지만, 당신의 웹/앱은 준비가 되지 않았을 경우 쿠버네티스는 해당 웹사이트의 니즈를 수용할 수 있도록 자동으로 새로운 컨테이너들을 만들 수 있다. 또한, 니즈가 줄어들면 컨테이너의 숫자를, 지정해둔 최소 숫자로 자동으로 조절해준다.
- 무중단(Fault tolerance-FT) 서비스
    - 기업에서는, 서버 업데이트를 위해서 사용자들이 잠든 새벽 시간을 활용하거나, 긴급 점검의 형태로 서비스를 일시 중단해왔다. 하지만, 쿠버네티스는 점진적 업데이트를 제공하기 때문에, 서비스를 중단하지 않고도 애플리케이션을 업데이트할 수 있다.
- 호환성(Vendor Lock In 해결)
    - 고객이 A사의 클라우드를 사용하다가 I사의 클라우드로 환경을 이전하고 싶을 때, 서로 다른 업체(Vendor)의 클라우드 제품 간에 호환 문제가 발생하여 이전하기 어려운 상황을 Vendor Lock In 이라고 한다 쿠버네티스는 도커 컨테이너를 기반으로 하는 오픈소스이기 때문에, 사용자들이 특정 업체에 종속되지 않고 클라우드의 환경들을 이전할 수 있다.
## 쿠버네티스 사용법
- 컨트롤 플레인: 쿠버네티스 노드를 제어하는 프로세스의 컬렉션이다. 여기에서 모든 태스크 할당이 시작된다.
- 노드: 컨트롤 플레인에서 할당된 요청 태스크를 수행하는 머신이다.
- 포드: 단일 노드에 배포된 하나 이상의 컨테이너 그룹입니다. 포드에 있는 모든 컨테이너는 IP 주소, IPC, 호스트 이름, 기타 리소스를 공유한다. 포드는 기본 컨테이너에서 네트워크와 스토리지를 추상화합니다. 이렇게 하면 클러스터에서 컨테이너를 더 쉽게 이동할 수 있다.
- 복제 컨트롤러: 이 컨트롤러는 클러스터에서 실행되어야 하는 동일한 포드 복사본의 개수를 제어한다.
- 서비스: 포드에서 작업 정의를 분리한다. 쿠버네티스 서비스 프록시는 클러스터에서 다른 위치로 이동된 경우나 교체된 경우에 상관없이 서비스 요청을 적절한 포드로 자동 수신한다.
- Kubelet: 이 서비스는 노드에서 실행되며 컨테이너 매니페스트를 읽고, 정의된 컨테이너가 시작되어 실행 중인지 확인한다.
- kubectl: 쿠버네티스의 커맨드 라인 구성 툴이다.